<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Index for various posts"><meta name=author content="Brent Pedersen"><link href=https://brentp.github.io/latest/blog/ rel=canonical><link rel=prev href=..><link href=archive/2025/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>DevBlog - Brent Pedersen</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/css/custom.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#blog class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Brent Pedersen" class="md-header__button md-logo" aria-label="Brent Pedersen" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Brent Pedersen </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> DevBlog </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> About </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Brent Pedersen" class="md-nav__button md-logo" aria-label="Brent Pedersen" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Brent Pedersen </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link md-nav__link--active" for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../tags/ class=md-nav__link> <span class=md-ellipsis> Tags </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=blog>Blog<a class=headerlink href=#blog title="Permanent link">&para;</a></h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2025-12-29 00:00:00+00:00">December 29, 2025</time></li> <li class=md-meta__item> 5 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=ai-coding><a href=2025/12/29/ai-coding/ class=toclink>AI Coding</a></h2> <p>This post is mostly about AI coding. Jump to the end if you're more interested in genomics libraries.</p> <h3 id=ai-coding_1><a class=toclink href=2025/12/29/ai-coding/#ai-coding_1>AI Coding</a></h3> <p>I use AI coding tools quite a bit, but over the last couple of weeks without writing a line of code (I may have edited a README), I made</p> <ol> <li> <p>a rust package to easily apply javascript expressions to a genomic variant: <a href=https://brentp.github.io/htsvcf/latest/htsvcf/ >https://brentp.github.io/htsvcf/latest/htsvcf/</a></p> </li> <li> <p>a javascript library for reading, writing VCF/BCF and modifying variants: <a href=https://www.npmjs.com/package/htsvcf>https://www.npmjs.com/package/htsvcf</a></p> </li> </ol> <p>Both of those use <a href=https://v8.dev>v8</a> as the javascript engine.</p> <p>I mostly used <a href=https://opencode.ai>opencode</a> and either GPT-5.2 or Claude Opus 4.5 using my <a href=https://docs.github.com/en/copilot/concepts/billing/individual-plans#github-copilot-pro>free github credits from having a "popular" open-source project</a> (but I do have a $20/month Codex sub, a $20 Cursor sub, and a <a href=https://z.ai/subscribe>$3/month GLM</a> sub). This was not possible prior to these models (and the progression of CLI coding tools). Opus 4.5 is very good; like it's different. And faster than GPT-5.2. Or previously, a project even smaller than this would at least require so much intervention that it would have taken much longer than it did and therefore have been infeasible as a side project/experiment. And, as a project grew, the complexity would bring down the efficacy of using LLMs; that didn't happen here. It's still a small project, but it's substantial and I do notice a sea-change. I had never published an NPM package prior to this and now have one that's automatically published via github action to be available on linux x64 and arm along with OSX (can also support whatever <a href=https://napi.rs/ >NAPI</a> supports). The models generally made code that I was happy with or that was easily adjusted with a single prompt.</p> <p>This was not a single "vibe-code", but rather on the order of 50 different individual prompts. I would decide a feature: "Allow setting INFO fields in VCF" or "support extracting genotypes and return as <code>{ alleles: [0, 1], phase: [false]}</code> for <code>0/1</code>" and then use <code>Plan</code> mode in opencode and then iterate on it and even ask it to find any holes in the plan. Once the plan was made, I'd let it go Brrrr in <code>Build</code> mode and sometimes check in, scroll-back through the output and occasionally intervene and interrupt it. My <a href=https://agents.md>AGENTS.md</a> indicates that the agent should update (specifically) <code>lib.rs</code> rust-docs and add tests and run <code>cargo clippy</code> and <code>fmt</code>. When it was done building, I'd look over the diff in <a href=https://cursor.com>cursor</a> and sometimes ask an LLM there to note any problems with the diff. Sometimes I'd add a new requirement at this stage and go back into <code>opencode</code>. I left opencode to manage its own context.</p> <p>I tried Gemini 3.0 a couple times and on brief look the code it generated was fine, but it was having trouble making edits. It would inject in the wrong place and take time to figure out how to undo the change and then re-insert it into the correct file location. I didn't notice a single time where this happened with GPT 5.2 or Opus 4.5 though I didn't review all of the intermediate output.</p> <h3 id=the-changing-ai-coding-experience><a class=toclink href=2025/12/29/ai-coding/#the-changing-ai-coding-experience>The Changing AI Coding Experience</a></h3> <p>This library that I wrote/managed the writing of is based on something I wanted to do for a long time. I've been embedding scripting interfaces into genomics tools<br> <a href=https://link.springer.com/article/10.1186/s13059-016-0973-5>since 2016</a> and since then have found it quite useful. I prefer Javascript syntax but it has always been easier to embed lua and still have good performance. I had an old <code>rust</code> <a href=https://github.com/brentp/help-repositories/tree/976b00c5c4b6d2c023ed92b585cc5b38f0207320>repo</a> where I had made a small example and tried to get help to understand why my minimal rust program with V8 scripting was leaking memory. I was not able to resolve that. In early december, I asked GPT 5.2 to fix the leak and make sure to update to latest v8 crate. It did, in one shot. And we went from there. What was striking to me was the rate of change in improvement. I had the sense previously that things were plateauing--the models were getting better but it wasn't changing that much. This felt very different. I was continually 1, 2, or 3-shotting substantial features with tests and documentation. I think writing a wrapper library is probably a nice use-case for the LLMs as they currently are, but the entire experience was easy. I guess there's a realization that this will continue to improve in months, not years and that what I offer now is taste and high-level guidance. I am excited about what I can build next. And also wondering what software engineering/programming will look like. And what will be my place in it. I don't have any deep thoughts here, just noticing this new reality encroaching.</p> <p>Below I'll write a bit about the actual libraries.</p> <h3 id=htsvcf><a class=toclink href=2025/12/29/ai-coding/#htsvcf>HTSVCF</a></h3> <p>Starting from the initial V8 Javascript::rust example project, I built, with opencode and LLMs, a library for <a href=https://github.com/rust-bio/rust-htslib>rust-htslib</a> that exposes most attributes that are available on a variant in <a href=https://pmc.ncbi.nlm.nih.gov/articles/PMC3137218/ >VCF format</a> to Javascript expressions. Concurrently, it built a <a href=https://www.npmjs.com/package/htsvcf>library</a> to read and write VCF files from Javascript (via bun or node).</p> <h4 id=rust><a class=toclink href=2025/12/29/ai-coding/#rust>rust</a></h4> <p>I am quite pleased with the syntax of the libraries. For the rust library that facilitates user expressions, the usage looks like this:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>use</span><span class=w> </span><span class=n>htsvcf</span><span class=p>::</span><span class=n>Evaluator</span><span class=p>;</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>use</span><span class=w> </span><span class=n>rust_htslib</span><span class=p>::</span><span class=n>bcf</span><span class=p>::{</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>Read</span><span class=p>};</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>reader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bcf</span><span class=p>::</span><span class=n>Reader</span><span class=p>::</span><span class=n>from_path</span><span class=p>(</span><span class=s>&quot;input.vcf.gz&quot;</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>eval</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Evaluator</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>reader</span><span class=p>.</span><span class=n>header</span><span class=p>())</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=c1>// Optionally define custom functions</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=n>eval</span><span class=p>.</span><span class=n>run</span><span class=p>(</span><span class=s>&quot;function passes(v) { return v.info(&#39;DP&#39;) &gt; 20 }&quot;</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=k>for</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>reader</span><span class=p>.</span><span class=n>records</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=n>eval</span><span class=p>.</span><span class=n>set_record</span><span class=p>(</span><span class=n>record</span><span class=p>);</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>eval</span><span class=p>.</span><span class=n>eval</span><span class=p>::</span><span class=o>&lt;</span><span class=kt>bool</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&quot;passes(variant)&quot;</span><span class=p>)</span><span class=o>?</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>        </span><span class=c1>// Use take() to get ownership of the record</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>record</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>eval</span><span class=p>.</span><span class=n>take</span><span class=p>().</span><span class=n>unwrap</span><span class=p>();</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>        </span><span class=c1>// write record to output, collect it, etc.</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=p>}</span>
</span></code></pre></div> <p>where the optional user function is:</p> <p><div class="language-Javascript highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kd>function</span><span class=w> </span><span class=nx>passes</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=nx>v</span><span class=p>.</span><span class=nx>info</span><span class=p>(</span><span class=s1>&#39;DP&#39;</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>20</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div> and the expression calling it is simply:</p> <div class="language-Javascript highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nb>eval</span><span class=p>.</span><span class=nb>eval</span><span class=o>::&lt;</span><span class=nx>bool</span><span class=o>&gt;</span><span class=p>(</span><span class=s2>&quot;passes(variant)&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>so we can handle other return times like i32, f32, f64, and (with some performance consequences) objects that serde::Deserialize can understand. <code>variant</code> is injected into the context for each variant (record) in the VCF file with <code>set_record</code>.</p> <p>There are other examples in the rust docs <a href=https://brentp.github.io/htsvcf/latest/htsvcf/index.html>here</a></p> <h4 id=javascript><a class=toclink href=2025/12/29/ai-coding/#javascript>Javascript</a></h4> <p>The Javascript library is available from npm (<code>bun install -g htsvcf</code>). And usage looks like:</p> <div class="language-Javascript highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>import</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=nx>Reader</span><span class=p>,</span><span class=w> </span><span class=nx>Writer</span><span class=w> </span><span class=p>}</span><span class=w> </span><span class=kr>from</span><span class=w> </span><span class=s2>&quot;htsvcf&quot;</span><span class=p>;</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=kd>const</span><span class=w> </span><span class=nx>reader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Reader</span><span class=p>(</span><span class=s2>&quot;samples.vcf.gz&quot;</span><span class=p>);</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1>// Print header info</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&quot;Samples:&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>reader</span><span class=p>.</span><span class=nx>header</span><span class=p>.</span><span class=nx>samples</span><span class=p>());</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=kd>const</span><span class=w> </span><span class=nx>dpDef</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>reader</span><span class=p>.</span><span class=nx>header</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&quot;INFO&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;DP&quot;</span><span class=p>);</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`DP field: </span><span class=si>${</span><span class=nx>dpDef</span><span class=p>.</span><span class=nx>type</span><span class=si>}</span><span class=sb> (</span><span class=si>${</span><span class=nx>dpDef</span><span class=p>.</span><span class=nx>description</span><span class=si>}</span><span class=sb>)`</span><span class=p>);</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=c1>// Add a custom INFO field to the header</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=nx>reader</span><span class=p>.</span><span class=nx>header</span><span class=p>.</span><span class=nx>addInfo</span><span class=p>(</span><span class=s2>&quot;HIGHQUAL&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;0&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;Flag&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;Variant passed quality filter&quot;</span><span class=p>);</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=c1>// Create a writer with the modified header</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=kd>const</span><span class=w> </span><span class=nx>writer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=ow>new</span><span class=w> </span><span class=nx>Writer</span><span class=p>(</span><span class=s2>&quot;filtered.vcf.gz&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>reader</span><span class=p>.</span><span class=nx>header</span><span class=p>);</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=c1>// Process variants. There&#39;s also a synchronous variant iterator that will be faster.</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=k>for</span><span class=w> </span><span class=k>await</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>v</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>reader</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=w>  </span><span class=c1>// Translate variant to the writer&#39;s header (required after modifying header)</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=w>  </span><span class=nx>v</span><span class=p>.</span><span class=nx>translate</span><span class=p>(</span><span class=nx>writer</span><span class=p>.</span><span class=nx>header</span><span class=p>);</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=w>  </span><span class=c1>// Filter by quality</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>v</span><span class=p>.</span><span class=nx>qual</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>v</span><span class=p>.</span><span class=nx>qual</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mf>30</span><span class=p>)</span><span class=w> </span><span class=k>continue</span><span class=p>;</span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=w>  </span><span class=c1>// Set our custom flag</span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=w>  </span><span class=nx>v</span><span class=p>.</span><span class=nx>set_info</span><span class=p>(</span><span class=s2>&quot;HIGHQUAL&quot;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>);</span>
</span><span id=__span-3-26><a id=__codelineno-3-26 name=__codelineno-3-26 href=#__codelineno-3-26></a>
</span><span id=__span-3-27><a id=__codelineno-3-27 name=__codelineno-3-27 href=#__codelineno-3-27></a><span class=w>  </span><span class=c1>// Get per-sample data</span>
</span><span id=__span-3-28><a id=__codelineno-3-28 name=__codelineno-3-28 href=#__codelineno-3-28></a><span class=w>  </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kd>const</span><span class=w> </span><span class=nx>s</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=nx>v</span><span class=p>.</span><span class=nx>samples</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-29><a id=__codelineno-3-29 name=__codelineno-3-29 href=#__codelineno-3-29></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=nx>s</span><span class=p>.</span><span class=nx>DP</span><span class=w> </span><span class=o>!==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>s</span><span class=p>.</span><span class=nx>DP</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mf>10</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-30><a id=__codelineno-3-30 name=__codelineno-3-30 href=#__codelineno-3-30></a><span class=w>      </span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`</span><span class=si>${</span><span class=nx>v</span><span class=p>.</span><span class=nx>chrom</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>v</span><span class=p>.</span><span class=nx>pos</span><span class=si>}</span><span class=sb> </span><span class=si>${</span><span class=nx>s</span><span class=p>.</span><span class=nx>sample_name</span><span class=si>}</span><span class=sb> DP=</span><span class=si>${</span><span class=nx>s</span><span class=p>.</span><span class=nx>DP</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span><span id=__span-3-31><a id=__codelineno-3-31 name=__codelineno-3-31 href=#__codelineno-3-31></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-32><a id=__codelineno-3-32 name=__codelineno-3-32 href=#__codelineno-3-32></a><span class=w>  </span><span class=p>}</span>
</span><span id=__span-3-33><a id=__codelineno-3-33 name=__codelineno-3-33 href=#__codelineno-3-33></a>
</span><span id=__span-3-34><a id=__codelineno-3-34 name=__codelineno-3-34 href=#__codelineno-3-34></a><span class=w>  </span><span class=c1>// Write the variant</span>
</span><span id=__span-3-35><a id=__codelineno-3-35 name=__codelineno-3-35 href=#__codelineno-3-35></a><span class=w>  </span><span class=nx>writer</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>v</span><span class=p>);</span>
</span><span id=__span-3-36><a id=__codelineno-3-36 name=__codelineno-3-36 href=#__codelineno-3-36></a><span class=p>}</span>
</span><span id=__span-3-37><a id=__codelineno-3-37 name=__codelineno-3-37 href=#__codelineno-3-37></a>
</span><span id=__span-3-38><a id=__codelineno-3-38 name=__codelineno-3-38 href=#__codelineno-3-38></a><span class=nx>writer</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span><span id=__span-3-39><a id=__codelineno-3-39 name=__codelineno-3-39 href=#__codelineno-3-39></a><span class=nx>reader</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></code></pre></div> <p>I have made efforts to keep both the rust and the Javascript side of things very fast. Please <a href=https://github.com/brentp/htsvcf/issues>get in touch</a> with any feedback.</p> <p>AI was <em>not</em> used to write this post.</p> <h3 id=shameless-plug><a class=toclink href=2025/12/29/ai-coding/#shameless-plug>Shameless Plug</a></h3> <p>I have been doing contracting work in genomics for some time and am looking for substantial projects in 2026 that are suited to my skills and knowledge with the possibility of helping patients. Read more about that <a href=https://brentp.github.io/latest/ >here</a> and <a href=mailto:bpederse@gmail.com>send me a message</a> if you have something in mind.</p> </div> </article> <nav class=md-pagination> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2025 Brent Pedersen </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.highlight", "search.share", "header.autohide", "content.code.copy", "content.action.edit", "content.action.view", "tags.index"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>